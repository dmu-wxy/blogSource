(window.webpackJsonp=window.webpackJsonp||[]).push([[25],{443:function(s,e,v){"use strict";v.r(e);var _=v(15),o=Object(_.a)({},(function(){var s=this,e=s.$createElement,v=s._self._c||e;return v("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[v("p",[s._v("会话固定攻击防御")]),s._v(" "),v("p",[v("a",{attrs:{href:"http://www.javaboy.org/2020/0514/springsecurity-sfa.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("江南一点雨 (javaboy.org)"),v("OutboundLink")],1)]),s._v(" "),v("h1",{attrs:{id:"_1-httpsession"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_1-httpsession"}},[s._v("#")]),s._v(" 1. HttpSession")]),s._v(" "),v("p",[v("code",[s._v("HttpSession")]),s._v("是一个服务端的概念，服务端生成的"),v("code",[s._v("HttpSession")]),s._v("都会有一个对应的"),v("code",[s._v("sessionid")]),s._v("，这个"),v("code",[s._v("sessionid")]),s._v("会通过"),v("code",[s._v("cookie")]),s._v("传递给前端，前端以后发送请求的时候，就会带上这个"),v("code",[s._v("sessionid")]),s._v("参数，服务端看到这个sessionid就会把前端请求和服务端的某一个"),v("code",[s._v("HttpSession")]),s._v("对应起来，形成“会话”的感觉。")]),s._v(" "),v("p",[s._v("浏览器关闭并不会导致服务端的"),v("code",[s._v("HttpSession")]),s._v("失效，想让服务端的HttpSession失效，要么手动调用"),v("code",[s._v("HttpSession#invalidate")]),s._v("方法，要么等到"),v("code",[s._v("session")]),s._v("自动过期（默认30分钟），要么重启服务器。")]),s._v(" "),v("p",[s._v("为什么关闭浏览器会给人一种"),v("code",[s._v("session")]),s._v("失效的效果呢，这是因为浏览器关闭之后，保存在浏览器里面的"),v("code",[s._v("sessionid")]),s._v("就丢了（默认情况下），所以再次打开浏览器访问服务端时，服务端会给浏览器分配一个新的"),v("code",[s._v("sessionid")]),s._v("，这个"),v("code",[s._v("sessionid")]),s._v("和之前的"),v("code",[s._v("HttpSession")]),s._v("对不上，所以会给人一种"),v("code",[s._v("session")]),s._v("失效的感觉。")]),s._v(" "),v("blockquote",[v("p",[s._v("在服务端的响应头中有一个 Set-Cookie 字段，该字段指示浏览器更新 sessionid，同时还有一个 HttpOnly 属性，这个表示通过 JS 脚本无法读取到 Cookie 信息，这样能有效的防止 XSS 攻击。")])]),s._v(" "),v("h1",{attrs:{id:"_2-固定会话攻击"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_2-固定会话攻击"}},[s._v("#")]),s._v(" 2. 固定会话攻击")]),s._v(" "),v("p",[s._v("英文名："),v("code",[s._v("session fixation attack")])]),s._v(" "),v("p",[s._v("前面说道，浏览器关闭并不会导致服务端的"),v("code",[s._v("HttpSession")]),s._v("失效，而固定会话攻击就是利用这一特性：攻击者通过某种方式获取受害者已经获取认证和授权的会话id，或者将会话id发送给受害者让其在不知情的情况下为会话id认证和授权，然后利用该会话id冒充受害者，造成会话固定攻击。")]),s._v(" "),v("p",[s._v("一般来说，会话固定攻击的流程是这样，以淘宝为例：")]),s._v(" "),v("ol",[v("li",[s._v("攻击者自己可以正常访问淘宝网站，在访问的过程中，淘宝网站给攻击者分配了一个 "),v("code",[s._v("sessionid")]),s._v("。")]),s._v(" "),v("li",[s._v("攻击者利用自己拿到的 "),v("code",[s._v("sessionid")]),s._v(" 构造一个淘宝网站的链接，并把该链接发送给受害者。")]),s._v(" "),v("li",[s._v("受害者使用该链接登录淘宝网站（该链接中含有 "),v("code",[s._v("sessionid")]),s._v("），登录成功后，一个合法的会话就成功建立。")]),s._v(" "),v("li",[s._v("攻击者利用手里的 "),v("code",[s._v("sessionid")]),s._v(" 冒充受害者。")])]),s._v(" "),v("p",[s._v("在这个过程中，如果淘宝网站支持 "),v("code",[s._v("URL")]),s._v(" 重写，那么攻击还会变得更加容易。")]),s._v(" "),v("p",[s._v("什么是 "),v("code",[s._v("URL")]),s._v(" 重写？就是用户如果在浏览器中禁用了 "),v("code",[s._v("cookie")]),s._v("，那么 "),v("code",[s._v("sessionid")]),s._v(" 自然也用不了了，所以有的服务端就支持把 "),v("code",[s._v("sessionid")]),s._v(" 放在请求地址中：")]),s._v(" "),v("div",{staticClass:"language- line-numbers-mode"},[v("pre",{pre:!0,attrs:{class:"language-text"}},[v("code",[s._v("http://www.taobao.com;jsessionid=xxxxxx\n")])]),s._v(" "),v("div",{staticClass:"line-numbers-wrapper"},[v("span",{staticClass:"line-number"},[s._v("1")]),v("br")])]),v("p",[s._v("如果服务端支持这种 URL 重写，那么对于攻击者来说，按照上面的攻击流程，构造一个这种地址简直太简单不过了。")]),s._v(" "),v("p",[s._v("不过这种请求地址在 "),v("code",[s._v("Spring Security")]),s._v(" 中应该很少见到（原因请见下文），但是在 "),v("code",[s._v("Shiro")]),s._v(" 中可能多多少少有见过。")]),s._v(" "),v("h1",{attrs:{id:"_3-防御固定会话攻击"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_3-防御固定会话攻击"}},[s._v("#")]),s._v(" 3. 防御固定会话攻击")]),s._v(" "),v("p",[s._v("Spring Security默认为固定会话攻击做了防御，主要体现在三个方面：")]),s._v(" "),v("ul",[v("li",[v("p",[s._v("请求地址中有"),v("code",[s._v(";")]),s._v("会直接拒绝")])]),s._v(" "),v("li",[v("p",[s._v("响应的 Set-Cookie 字段中有 HttpOnly 属性，这种方式避免了通过 XSS 攻击来获取 Cookie 中的会话信息进而达成会话固定攻击。")])]),s._v(" "),v("li",[v("p",[s._v("固定会话攻击的根源在于sessionid不变，那么就可以让sessionid在请求时变动：")]),s._v(" "),v("img",{staticStyle:{zoom:"80%"},attrs:{src:"https://cdn.jsdelivr.net/gh/dmu-wxy/pic/blog/20200513120930.png"}})])]),s._v(" "),v("ol",[v("li",[s._v("migrateSession 表示在登录成功之后，创建一个新的会话，然后将旧的 session 中的信息复制到新的 session 中，"),v("strong",[s._v("默认即此")]),s._v("。")]),s._v(" "),v("li",[s._v("none 表示不做任何事情，继续使用旧的 session。")]),s._v(" "),v("li",[s._v("changeSessionId 表示 session 不变，但是会修改 sessionid，这实际上用到了 Servlet 容器提供的防御会话固定攻击。")]),s._v(" "),v("li",[s._v("newSession 表示登录后创建一个新的 session。")])])])}),[],!1,null,null,null);e.default=o.exports}}]);