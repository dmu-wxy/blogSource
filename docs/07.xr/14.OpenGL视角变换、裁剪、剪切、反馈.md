---
title: OpenGL视角变换、裁剪、剪切、反馈
date: 2022-09-12 15:48:59
permalink: /pages/d32036/
categories:
  - xr
tags:
  - 
---
OpenGL编程指南第五章：视口变换、裁减、剪切与反馈

<!-- more -->

# 1. 观察视图

将三维空间的模型投影到二维的关键方法，就是齐次坐标的应用、矩阵乘法的线性变换方法，以及视口映射。

## 1.1 视图模型

见视图变换。

## 1.2 相机模型

常见的视图变换操作可以类比为使用照相机拍摄照片的过程。

![图5-1 视锥体的配置和放置](F:\blogSource\docs\unity\07.openGL_视角变换_裁剪_剪切_反馈.assets\image-20220909154132085.png)

- 将相机移动到准备拍摄的位置，将它对准某个方向（视图变换）
- 将准备拍摄的对象移动到场景中必要的位置上（模型变换）
- 设置相机的焦距，或者调整缩放比例（投影变换）
- 拍摄照片（应用变换结果）
- 将结果图像进行拉伸或者挤压，将它变换到需要的图片大小（视口变换）

通常第一步和第二部合并为一个步骤——视图变换。

OpenGL在整个处理过程中所用到的坐标系统：

<img src="F:\blogSource\docs\unity\07.openGL_视角变换_裁剪_剪切_反馈.assets\image-20220909160440887.png" alt="图5-2 OpenGL中坐标系统" style="zoom:67%;" />

<img src="F:\blogSource\docs\unity\07.openGL_视角变换_裁剪_剪切_反馈.assets\image-20220909160916172.png" alt="图5-3 OpenGL中未定义用户坐标系统" style="zoom:67%;" />

**视锥体**

在视锥体之外的几何体会被清除，包括比近平面更近的和比远平面更远的几何体。

<img src="F:\blogSource\docs\unity\07.openGL_视角变换_裁剪_剪切_反馈.assets\image-20220909161425856.png" alt="图5-4 视截锥体" style="zoom:67%;" />

## 1.3 正交视图模型

例如三视图，可以简单的通过忽略x / y / z 三个坐标轴中二点一个来实现这一效果。

# 2. 用户变换

必须在顶点着色阶段、细分着色阶段、几何着色阶段后生成可用于透视除法的齐次坐标（剪切坐标）。

```
// 先用A矩阵变换、再用B矩阵变换
C = BA
```

## 2.1 矩阵乘法

*线性代数*

不遵守交换律，但遵守结合律。

## 2.2 齐次坐标

将三维的笛卡尔坐标转换为四维的齐次坐标主要由两个好处：1. 可以进一步完成透视变换；2. 可以使用线性变换来实现模型的平移。这种投影变换是透视效果实现的关键步骤，也是必须在着色器中实现的一个步骤。

**齐次坐标**

三维笛卡尔坐标的平移操作无法通过与3x3矩阵的乘法操作完成。还需要一个额外的向量，将点(0,0,0)移动到另一个位置，叫做仿射变换。而只需要将数据置入四维坐标空间中，仿射变换就回归成了简单的线性变换了。

齐次坐标总是有一个额外的分量，并且如果所以分量都除以一个相同的值，不会改变坐标位置。它所表达的其实是方向而不是位置。

<img src="F:\blogSource\docs\unity\07.openGL_视角变换_裁剪_剪切_反馈.assets\image-20220909170629982.png" alt="image-20220909170629982" style="zoom: 80%;" />

如果齐次坐标的最后一个分量为0，那么他表示的是一个“无限远处的点”。任何方向都有一个无限远的点，就像两条平行线在远处相交一样（透视效果）。

直接添加第四个w分量，设置为1.0来实现齐次坐标的建立。
所有分量除以w，并舍弃，重新得到笛卡尔坐标。

w越大，坐标越远，绘制时会还原会笛卡尔坐标，因此绘制的比例越小（除数 w 大）。

## 2.3 线性变换与矩阵

- 平移：沿x轴正方向平移2.5
  $$
  \left[ 
  \begin{matrix} 
  1.0 &0.0 &0.0 &2.5\\ 
  0.0 &1.0 &0.0 &0.0\\
  0.0 &0.0 &1.0 &0.0\\
  0.0 &0.0 &0.0 &1.0
  \end{matrix} 
  \right]
  \left(
  \begin{matrix} 
  x\\ 
  y\\
  z\\
  1.0
  \end{matrix} 
  \right)
  $$

- 缩放：放大三倍（如果不在原点上，则这个操作会远离原点3倍，如果不希望位置改变，可以先移动到原点，缩放后移动回去【三个操作合为一个矩阵】）
  $$
  \left[ 
  \begin{matrix} 
  3.0 &0.0 &0.0 &0.0\\ 
  0.0 &3.0 &0.0 &0.0\\
  0.0 &0.0 &3.0 &0.0\\
  0.0 &0.0 &0.0 &1.0
  \end{matrix} 
  \right]
  \left(
  \begin{matrix} 
  x\\ 
  y\\
  z\\
  1.0
  \end{matrix} 
  \right)
  $$

- 旋转：沿着z轴逆时针旋转50度
  $$
  \left[ 
  \begin{matrix} 
  cos50 &-sin50 &0.0 &0.0\\ 
  sin50 &cos50 &0.0 &0.0\\
  0.0 &0.0 &1.0 &0.0\\
  0.0 &0.0 &0.0 &1.0
  \end{matrix} 
  \right]
  \left(
  \begin{matrix} 
  x\\ 
  y\\
  z\\
  1.0
  \end{matrix} 
  \right)
  $$
  绕着x轴
  $$
  \left[ 
  \begin{matrix} 
  1.0 &0.0 &0.0 &0.0\\ 
  0.0 &cos\theta &-sin\theta &0.0\\
  0.0 &sin\theta &cos\theta &0.0\\
  0.0 &0.0 &0.0 &1.0
  \end{matrix} 
  \right]
  \left(
  \begin{matrix} 
  x\\ 
  y\\
  z\\
  1.0
  \end{matrix} 
  \right)
  $$
  绕着y轴
  $$
  \left[ 
  \begin{matrix} 
  cos\theta &0.0 &-sin\theta &0.0\\ 
  0.0 &1.0 &0.0 &0.0\\
  sin\theta &0.0 &cos\theta &0.0\\
  0.0 &0.0 &0.0 &1.0
  \end{matrix} 
  \right]
  \left(
  \begin{matrix} 
  x\\ 
  y\\
  z\\
  1.0
  \end{matrix} 
  \right)
  $$
  这种操作同样会绕着原点旋转

- 透视投影

## 2.4法线变换

## 2.5 OpenGL矩阵

# 3.OpenGL变换
